(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system-menu-list"],{"1c8c":function(n,t,e){"use strict";(function(n){var i=e("4ea4");e("7db0"),e("4160"),e("d3b7"),e("38cf"),e("159b"),e("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=i(e("5530")),u=e("2f62"),s=[];function r(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n.title=(e?"　".repeat(e)+"|-":"")+n.name,t.push(n),n.children&&c(n.children,t,e+1)}function c(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.forEach((function(n){return r(n,t,e)})),t}var o={data:function(){return{loading:!0,menus:[],errMsg:"",currentTab:"menus",selectedPluginMenuIndexs:[]}},computed:{pluginMenus:function(){var n=[];if(!this.$hasRole("admin"))return n;var t=this.menus;return t.length?(s.forEach((function(e){t.find((function(n){return n.menu_id===e.menu_id}))||n.push(e)})),n):n}},watch:{pluginMenus:function(n){n.length||(this.currentTab="menus")}},onLoad:function(){this.loadData()},methods:(0,a.default)((0,a.default)({},(0,u.mapActions)({init:"app/init"})),{},{switchTab:function(n){this.currentTab=n},loadData:function(){var n=this;this.loading=!0,this.$request("system/menu/list",{},{showModal:!1}).then((function(t){n.menus=c(t)})).catch((function(t){n.errMsg=t.message})).finally((function(){n.loading=!1}))},navigateTo:function(n,t){var e=this;uni.navigateTo({url:n,events:{refreshData:function(){e.loadData(t)}}})},confirmDelete:function(n){var t=this,e="是否删除该菜单？";this.menus.find((function(t){return t.parent_id===n.menu_id}))&&(e="是否删除该菜单及其所有子菜单？"),uni.showModal({title:"提示",content:e,success:function(e){e.confirm&&(uni.showLoading({mask:!0}),t.$request("system/menu/delete",{id:n._id}).then((function(){t.init(),t.loadData()})).finally((function(){uni.hideLoading()})))}})},pluginMenuSelectChange:function(n){this.selectedPluginMenuIndexs=n.detail.index},addPluginMenus:function(t){var e=this;if(!this.selectedPluginMenuIndexs.length)return uni.showModal({title:"提示",content:"请选择要添加的菜单！",showCancel:!1});var i=this.pluginMenus,a=[];this.selectedPluginMenuIndexs.forEach((function(n){var t=i[n];if(t){var e=JSON.parse(JSON.stringify(t));delete e.json,a.push(e)}})),uni.showModal({title:"提示",content:"您确认要添加已选中的菜单吗？",success:function(t){if(t.confirm){uni.showLoading({mask:!0});var u=a.length===i.length;n.database().collection("opendb-admin-menus").add(a).then((function(n){e.init(),uni.showModal({title:"提示",content:"添加菜单成功！",showCancel:!1,success:function(){e.$refs.pluginMenusTable.clearSelection(),u&&(e.currentTab="menus"),e.loadData()}})})).catch((function(n){uni.showModal({title:"提示",content:n.message,showCancel:!1})})).finally((function(){uni.hideLoading()}))}}})}})};t.default=o}).call(this,e("a9ff")["default"])},"2ef1":function(n,t,e){"use strict";e.r(t);var i=e("1c8c"),a=e.n(i);for(var u in i)"default"!==u&&function(n){e.d(t,n,(function(){return i[n]}))}(u);t["default"]=a.a},"38cf":function(n,t,e){var i=e("23e7"),a=e("1148");i({target:"String",proto:!0},{repeat:a})},"5a83":function(n,t,e){"use strict";var i=e("c886"),a=e.n(i);a.a},"66ff":function(n,t,e){"use strict";e.d(t,"b",(function(){return a})),e.d(t,"c",(function(){return u})),e.d(t,"a",(function(){return i}));var i={uniBadge:e("5f6d").default,uniTable:e("e10b").default,uniTr:e("d052").default,uniTh:e("fbe3").default,uniTd:e("1ed0").default},a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return e("v-uni-view",[e("v-uni-view",{staticClass:"uni-tabs__header"},[e("v-uni-view",{staticClass:"uni-tabs__nav-wrap"},[e("v-uni-view",{staticClass:"uni-tabs__nav-scroll"},[e("v-uni-view",{staticClass:"uni-tabs__nav"},[e("v-uni-view",{staticClass:"uni-tabs__item",class:{"is-active":"menus"===n.currentTab},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.switchTab("menus")}}},[n._v("菜单管理")]),n.pluginMenus.length?e("v-uni-view",{staticClass:"uni-tabs__item",class:{"is-active":"pluginMenus"===n.currentTab},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.switchTab("pluginMenus")}}},[n._v("待添加菜单"),e("uni-badge",{staticClass:"menu-badge",attrs:{text:n.pluginMenus.length,type:"error"}})],1):n._e()],1)],1)],1)],1),e("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"menus"===n.currentTab,expression:"currentTab==='menus'"}]},[e("v-uni-view",{staticClass:"uni-header",staticStyle:{"border-bottom":"0","margin-bottom":"-15px"}},[e("v-uni-view",{staticClass:"uni-group"},[e("v-uni-button",{attrs:{size:"mini",plain:"true",type:"primary"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateTo("./add")}}},[n._v("新增一级菜单")])],1),e("v-uni-view",{staticClass:"uni-group"})],1),e("v-uni-view",{staticClass:"uni-container"},[e("uni-table",{attrs:{loading:n.loading,emptyText:n.errMsg||"没有更多数据",border:!0,stripe:!0}},[e("uni-tr",[e("uni-th",{attrs:{align:"center"}},[n._v("排序")]),e("uni-th",{attrs:{width:"200",align:"center"}},[n._v("名称")]),e("uni-th",{attrs:{align:"center"}},[n._v("标识")]),e("uni-th",{attrs:{align:"center"}},[n._v("URL")]),e("uni-th",{attrs:{width:"100",align:"center"}},[n._v("是否启用")]),e("uni-th",{attrs:{width:"160",align:"center"}},[n._v("操作")])],1),n._l(n.menus,(function(t,i){return e("uni-tr",{key:i},[e("uni-td",{attrs:{align:"center"}},[n._v(n._s(t.sort))]),e("uni-td",[n._v(n._s(t.title))]),e("uni-td",[n._v(n._s(t.menu_id))]),e("uni-td",[n._v(n._s(t.url))]),e("uni-td",{class:{"menu-disable":!t.enable},attrs:{align:"center"}},[n._v(n._s(t.enable?"已启用":"未启用"))]),e("uni-td",{attrs:{align:"center"}},[e("v-uni-view",{staticClass:"uni-group"},[t.url?n._e():e("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateTo("./add?parent_id="+t.menu_id,!1)}}},[n._v("子菜单")]),e("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateTo("./edit?id="+t._id,!1)}}},[n._v("修   改")]),"system_menu"!==t.menu_id&&"system_management"!==t.menu_id?e("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"warn"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.confirmDelete(t)}}},[n._v("删   除")]):n._e()],1)],1)],1)}))],2)],1)],1),e("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"pluginMenus"===n.currentTab,expression:"currentTab==='pluginMenus'"}]},[e("v-uni-view",{staticClass:"uni-header",staticStyle:{"border-bottom":"0","margin-bottom":"-15px"}},[e("v-uni-view",{staticClass:"uni-group"},[e("v-uni-button",{staticStyle:{width:"130px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.addPluginMenus.apply(void 0,arguments)}}},[n._v("添加选中的菜单")])],1),e("v-uni-view",{staticClass:"uni-group"})],1),e("v-uni-view",{staticClass:"uni-container"},[e("uni-table",{ref:"pluginMenusTable",attrs:{type:"selection",border:!0,stripe:!0},on:{"selection-change":function(t){arguments[0]=t=n.$handleEvent(t),n.pluginMenuSelectChange.apply(void 0,arguments)}}},[e("uni-tr",[e("uni-th",{attrs:{align:"center"}},[n._v("名称（标识）")]),e("uni-th",{attrs:{align:"center"}},[n._v("URL")]),e("uni-th",{attrs:{align:"center"}},[n._v("插件菜单 json 文件")])],1),n._l(n.pluginMenus,(function(t,i){return e("uni-tr",{key:i},[e("uni-td",[n._v(n._s(t.name)+"（"+n._s(t.menu_id)+"）")]),e("uni-td",[n._v(n._s(t.url))]),e("uni-td",[n._v(n._s(t.json))])],1)}))],2),e("v-uni-view",{staticClass:"uni-sub-title",staticStyle:{"margin-top":"15px"}},[n._v("以上待添加菜单来自于三方插件，添加后，将显示在菜单管理中，若不希望显示在上述表格中时，可手动删除项目中对应的`插件id-menu.json`文件。")])],1)],1)],1)},u=[]},"853c":function(n,t,e){"use strict";e.r(t);var i=e("66ff"),a=e("2ef1");for(var u in a)"default"!==u&&function(n){e.d(t,n,(function(){return a[n]}))}(u);e("5a83");var s,r=e("f0c5"),c=Object(r["a"])(a["default"],i["b"],i["c"],!1,null,"2e8d792c",null,!1,i["a"],s);t["default"]=c.exports},c749:function(n,t,e){var i=e("24fb");t=i(!1),t.push([n.i,"\n.menu-disable[data-v-2e8d792c]{color:red}.menu-badge[data-v-2e8d792c]{position:absolute;top:0;right:5px}",""]),n.exports=t},c886:function(n,t,e){var i=e("c749");"string"===typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);var a=e("4f06").default;a("72cfd8e2",i,!0,{sourceMap:!1,shadowMode:!1})}}]);